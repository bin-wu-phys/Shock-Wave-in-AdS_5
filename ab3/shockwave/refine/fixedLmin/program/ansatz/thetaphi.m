function [theta phi] = thetaphi(dr,dri, B, S, tau, a4, b4, b4t1, b4t2, r)
N=length(r);
drcs=tau*r.^3+r.^2+(-(1/(15*tau^4))+(2*b4)/5)./r.^2+(28+3*tau^4*(2*a4+4*b4+15*tau*(b4t1)))./(135*tau^5*r.^3)+(-2668+3*tau^4*(-152*a4-304*b4+15*tau*(11*(b4t1)+21*tau*(b4t2))))./(5670*tau^6*r.^4);
cs = 0.25*tau*r.^4 + r.^3/3 + 0.25*tau*a4 + ( -6*b4 + 1/tau^4)./(15*r) - ( 28+3*tau^4*( 2*a4 + 4*b4 + 15*tau*b4t1 ) )./(270*tau^5*r.^2) + ( 2668 + 3*tau^4*( 152*a4 + 304*b4 - 15*tau*( 11*b4t1 + 21*tau*b4t2 ) ) )./(17010*tau^6*r.^3);
theta = [0; dri*(S(2:N)-drcs(2:N))] + cs;  

drcb=sqrt(r)/(2*sqrt(tau))-sqrt(1./r)/(12*tau^(3/2))-(1./r).^(3/2)/(16*tau^(5/2))-((-168+768*tau^4*b4)*(1./r).^(5/2))/(256*tau^(7/2))-(5*(5680+3072*tau*(2*tau^3*b4+3*tau^4*(b4t1)))*(1./r).^(7/2))/(12288*tau^(9/2))-(7*(-226144+1024*tau^4*(-8*a4-54*b4+120*tau*(b4t1)+90*tau^2*(b4t2)))*(1./r).^(9/2))/(245760*tau^(11/2));
cb = r.^(1.5)/(3*tau^0.5) - r.^(0.5)/(6*tau^(1.5)) + 1./(8*tau^(2.5)*r.^0.5) + (-7 + 32*tau^4*b4 )./(16*tau^(3.5)*r.^(1.5)) + (355+192*tau^4*( 2*b4 + 3*tau*b4t1 ))./(384*r.^2.5*tau^4.5) + ( -7067 + 64*tau^4*( -4*a4 - 27*b4 + 15*tau*( 4*b4t1 + 3*tau*b4t2 ) ) )./( 3840*r.^3.5*tau^5.5 );
drphi = 3*(dr*B).*(S.^(-0.5)).*theta;
phi = [0; dri*(drphi(2:N)-drcb(2:N))] +cb;